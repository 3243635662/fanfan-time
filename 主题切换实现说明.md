# 项目主题切换实现说明

## 概述

本项目采用 SCSS + CSS 自定义属性（CSS Variables）的方案实现主题切换功能，支持浅色模式和深色模式的平滑过渡。这种方案具有良好的可维护性、可扩展性和性能表现。

## 实现方案

### 1. 核心技术栈

- **SCSS**：用于编写模块化、可维护的样式代码
- **CSS 自定义属性**：用于动态切换主题变量
- **Pinia**：用于管理主题状态
- **Vue 3**：用于构建交互式界面

### 2. 目录结构

```
src/
├── styles/
│   ├── _variables.scss    # 主题变量定义
│   ├── _mixins.scss       # SCSS 混合宏
│   └── global.scss        # 全局样式和主题切换逻辑
├── store/
│   └── setting.ts         # 主题状态管理
└── components/            # 组件样式使用主题变量
```

### 3. 主题变量设计

#### 3.1 基础变量定义

在 `_variables.scss` 中定义了基础颜色变量：

```scss
// 卡片颜色
$color-rose: #ebd4d0;
$color-lavender: #efe4fd;
$color-sky: #cbe4e9;
$color-cream: #fef6de;
$color-mint: #e2f7d9;
$color-brown: #8d6e63;

// 卡片颜色 - 深色模式
$color-rose-dark: #8b6f67;
$color-lavender-dark: #6b5d9e;
$color-sky-dark: #5a8c94;
$color-cream-dark: #9e8f5f;
$color-mint-dark: #638f57;
$color-brown-dark: #6d564c;
```

#### 3.2 CSS 自定义属性

在 `global.scss` 中定义了 CSS 自定义属性，用于动态切换主题：

```scss
:root {
  // 浅色模式颜色
  --color-bg-primary: #ffffff;
  --color-text-primary: #1a1a1a;
  --color-text-secondary: #4a4a4a;
  // ... 其他浅色模式变量
  
  // 卡片主题颜色 - 带透明度的背景色
  --card-bg-rose: rgba(235, 212, 208, 0.75);
  --card-bg-lavender: rgba(239, 228, 253, 0.75);
  // ... 其他卡片颜色
}

body.dark-mode {
  // 深色模式颜色
  --color-bg-primary: #0d0d0d;
  --color-text-primary: #ffffff;
  --color-text-secondary: #d9d9d9;
  // ... 其他深色模式变量
  
  // 卡片主题颜色 - 深色模式（带透明度）
  --card-bg-rose: rgba(139, 111, 103, 0.85);
  --card-bg-lavender: rgba(107, 93, 158, 0.85);
  // ... 其他卡片颜色
}
```

### 4. 主题切换逻辑

#### 4.1 状态管理

在 `setting.ts` 中使用 Pinia 管理主题状态：

```typescript
import { defineStore } from "pinia";
import { ref, watch } from "vue";

export const useSettingStore = defineStore("setting", () => {
  const isDark = ref(false);

  const toggleDarkMode = () => {
    isDark.value = !isDark.value;
  };

  // 监听 isDark 状态变化，更新 body 类名
  watch(isDark, (newValue) => {
    if (newValue) {
      document.body.classList.add("dark-mode");
    } else {
      document.body.classList.remove("dark-mode");
    }
  }, { immediate: true });

  return {
    isDark,
    toggleDarkMode
  };
});
```

#### 4.2 组件中使用主题变量

在组件样式中直接使用 CSS 自定义属性：

```scss
.container {
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  transition: all var(--transition-duration) ease;
}

.card {
  background-color: var(--card-bg-rose);
  backdrop-filter: blur(8px);
}
```

### 5. 平滑过渡效果

通过在 CSS 中添加过渡动画，实现主题切换时的平滑效果：

```scss
body {
  transition: all var(--transition-duration) ease-in-out;
}

.container {
  transition: all var(--transition-duration) ease;
}
```

## 为什么有利于项目维护

### 1. 集中管理主题变量

- 所有主题相关的变量都集中定义在 `global.scss` 中，便于统一管理和修改
- 浅色模式和深色模式的变量定义在同一个文件中，便于对比和维护
- 变量命名规范统一，易于理解和使用

### 2. 模块化设计

- 使用 SCSS 模块化特性，将变量、混合宏和全局样式分离
- 组件样式只需要引用 CSS 自定义属性，不需要关心具体的主题实现
- 便于团队协作，不同开发者可以独立开发组件，无需担心主题冲突

### 3. 良好的可扩展性

- 新增主题只需要在 `global.scss` 中添加新的变量定义
- 支持多种主题模式，如浅色、深色、高对比度模式等
- 组件自动适配新主题，无需修改组件代码

### 4. 高性能

- CSS 自定义属性的切换由浏览器原生支持，性能优异
- 避免了使用 JavaScript 动态修改大量 DOM 元素样式的性能开销
- 过渡动画使用 CSS 实现，性能流畅

### 5. 代码复用

- 使用 SCSS 混合宏（@mixin）封装通用样式，减少重复代码
- 组件可以直接复用主题变量，无需重复定义
- 便于维护和更新，修改一处即可影响所有使用该变量的组件

## 代码示例

### 1. 变量定义示例

```scss
// _variables.scss
$primary: #1c7ec0;
$danger: #e63946;
$success: #2ecc71;

// 卡片颜色
$color-rose: #ebd4d0;
$color-lavender: #efe4fd;

// 卡片颜色 - 深色模式
$color-rose-dark: #8b6f67;
$color-lavender-dark: #6b5d9e;
```

### 2. 主题切换示例

```scss
// global.scss
:root {
  --primary-color: #1c7ec0;
  --bg-color: #ffffff;
  --text-color: #1a1a1a;
}

body.dark-mode {
  --primary-color: #3498db;
  --bg-color: #0d0d0d;
  --text-color: #ffffff;
}
```

### 3. 组件使用示例

```vue
<template>
  <div class="card">
    <h3 class="card-title">Card Title</h3>
    <p class="card-content">Card Content</p>
  </div>
</template>

<style scoped lang="scss">
.card {
  background-color: var(--bg-color);
  color: var(--text-color);
  border: 1px solid var(--primary-color);
  padding: 16px;
  border-radius: 8px;
  transition: all var(--transition-duration) ease;
}

.card-title {
  color: var(--primary-color);
  font-size: 18px;
  margin-bottom: 8px;
}
</style>
```

## 最佳实践

1. **始终使用 CSS 自定义属性**：组件样式中应优先使用 CSS 自定义属性，避免硬编码颜色值
2. **统一命名规范**：变量命名应遵循统一的规范，如 `--color-bg-primary`、`--color-text-secondary`
3. **添加过渡效果**：为主题相关的样式添加过渡效果，提升用户体验
4. **集中管理变量**：所有主题变量应集中定义在 `global.scss` 中，便于管理和维护
5. **使用语义化命名**：变量名应具有明确的语义，便于理解和使用
6. **定期审查和优化**：定期审查主题变量，移除未使用的变量，优化变量命名

## 总结

本项目采用 SCSS + CSS 自定义属性的方案实现主题切换功能，具有良好的可维护性、可扩展性和性能表现。这种方案便于集中管理主题变量，支持平滑过渡效果，易于扩展新的主题模式，是一种现代化、高效的主题切换实现方案。

通过这种方案，我们可以轻松实现：
- 浅色模式和深色模式的切换
- 主题变量的集中管理和修改
- 组件样式的自动适配
- 平滑的过渡动画效果
- 良好的代码复用和可维护性

这种实现方式不仅提升了用户体验，也便于项目的长期维护和扩展。